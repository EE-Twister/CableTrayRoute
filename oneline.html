<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Simple one-line diagram editor.">
  <title>One-Line Diagram</title>
  <link rel="icon" href="icons/favicon.svg" type="image/svg+xml">
  <link rel="stylesheet" href="style.css">
  <link rel="stylesheet" href="oneline.css">
  <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/svg2pdf.js@2.0.1/dist/svg2pdf.umd.min.js"></script>
  <script type="module" src="dataStore.mjs" defer></script>
  <script type="module" src="oneline.js" defer></script>
  <script type="module" src="scenarios.js" defer></script>
</head>
<body>
  <a href="#main-content" class="skip-link">Skip to main content</a>
  <nav class="top-nav">
    <button id="nav-toggle" class="nav-toggle" aria-label="Toggle navigation" aria-controls="nav-links" aria-expanded="false">â˜°</button>
    <div id="nav-links" class="nav-links">
      <a href="index.html">Home</a>
      <a href="equipmentlist.html">Equipment List</a>
      <a href="loadlist.html">Load List</a>
      <a href="cableschedule.html">Cable Schedule</a>
      <a href="panelschedule.html">Panel Schedule</a>
      <a href="racewayschedule.html">Raceway Schedule</a>
      <a href="ductbankroute.html">Ductbank</a>
      <a href="cabletrayfill.html">Tray Fill</a>
      <a href="conduitfill.html">Conduit Fill</a>
      <a href="optimalRoute.html">Optimal Route</a>
      <a href="oneline.html" class="active" aria-current="page">One-Line</a>
      <button id="studies-panel-btn" type="button">Studies</button>
      <button id="settings-btn" class="settings-btn" aria-label="Settings" aria-expanded="false">âš™</button>
    </div>
  </nav>
  <div id="settings-menu" class="settings-menu">
    <label><input type="checkbox" id="dark-toggle"> Dark Mode</label>
    <label><input type="checkbox" id="compact-toggle" aria-label="Enable compact table mode"> Compact Mode</label>
    <label for="unit-select">Units
      <select id="unit-select">
        <option value="imperial">Imperial</option>
        <option value="metric">Metric</option>
      </select>
    </label>
    <button id="help-btn" aria-expanded="false">Site Help</button>
    <button id="export-project-btn">Export Project</button>
    <button id="import-project-btn">Import Project</button>
    <button id="export-reports-btn">Export All Reports</button>
    <input type="file" id="import-project-input" accept=".ctr.json" class="hidden-input">
    <button id="prefix-settings-btn">Label Prefixes</button>
    <button id="update-defaults-btn">Update Defaults</button>
  </div>
  <div class="container">
    <main id="main-content" class="main-content">
      <header class="page-header">
        <h1>One-Line Diagram</h1>
        <p>Create and link components to schedules.</p>
      </header>
      <section class="card">
        <div class="sheet-controls">
          <div class="scenario-controls">
            <select id="scenario-select"></select>
            <button id="scenario-duplicate-btn" type="button" class="btn">Duplicate</button>
            <button id="scenario-diff-btn" type="button" class="btn">Diff</button>
            <button id="revision-btn" type="button" class="btn">Revisions</button>
          </div>
          <div id="sheet-tabs" class="sheet-tabs"></div>
          <div class="sheet-action-group">
            <button id="add-sheet-btn" class="btn icon-button" title="Add Sheet" aria-label="Add Sheet">+</button>
            <button id="rename-sheet-btn" class="btn icon-button" title="Rename Sheet" aria-label="Rename Sheet">âœŽ</button>
            <button id="delete-sheet-btn" class="btn icon-button" title="Delete Sheet" aria-label="Delete Sheet">ðŸ—‘</button>
            <button id="diagram-export-btn" type="button" class="btn icon-button" title="Export Diagram" aria-label="Export Diagram"><img src="icons/toolbar/export.svg" alt=""></button>
            <input type="file" id="diagram-import-input" accept=".json" class="hidden-input">
            <button id="diagram-import-btn" type="button" class="btn icon-button" title="Import Diagram" aria-label="Import Diagram"><img src="icons/toolbar/import.svg" alt=""></button>
            <button id="diagram-share-btn" type="button" class="btn">Share</button>
            <button id="tour-btn" type="button" class="btn">Tour</button>
          </div>
        </div>
        <div class="toolbar">
          <button id="connect-btn" class="icon-button btn" title="Connect" aria-label="Connect"><img src="icons/toolbar/connect.svg" alt=""></button>
          <button id="dimension-btn" class="icon-button btn" title="Dimension" aria-label="Dimension"><img src="icons/toolbar/dimension.svg" alt=""></button>
          <button id="undo-btn" class="icon-button btn" title="Undo" aria-label="Undo"><img src="icons/toolbar/undo.svg" alt=""></button>
          <button id="redo-btn" class="icon-button btn" title="Redo" aria-label="Redo"><img src="icons/toolbar/redo.svg" alt=""></button>
          <button id="align-left-btn" class="icon-button btn" title="Align Left" aria-label="Align Left"><img src="icons/toolbar/align-left.svg" alt=""></button>
          <button id="align-right-btn" class="icon-button btn" title="Align Right" aria-label="Align Right"><img src="icons/toolbar/align-right.svg" alt=""></button>
          <button id="align-top-btn" class="icon-button btn" title="Align Top" aria-label="Align Top"><img src="icons/toolbar/align-top.svg" alt=""></button>
          <button id="align-bottom-btn" class="icon-button btn" title="Align Bottom" aria-label="Align Bottom"><img src="icons/toolbar/align-bottom.svg" alt=""></button>
          <button id="distribute-h-btn" class="icon-button btn" title="Distribute Horizontal" aria-label="Distribute Horizontal"><img src="icons/toolbar/distribute-h.svg" alt=""></button>
          <button id="distribute-v-btn" class="icon-button btn" title="Distribute Vertical" aria-label="Distribute Vertical"><img src="icons/toolbar/distribute-v.svg" alt=""></button>
          <button id="export-btn" class="icon-button btn" title="Export" aria-label="Export"><img src="icons/toolbar/export.svg" alt=""></button>
          <button id="export-pdf-btn" class="btn" title="Export PDF" aria-label="Export PDF">Export PDF</button>
          <button id="export-dxf-btn" class="btn" title="Export DXF" aria-label="Export DXF">Export DXF</button>
          <button id="export-dwg-btn" class="btn" title="Export DWG" aria-label="Export DWG">Export DWG</button>
          <input type="file" id="import-input" accept=".json" class="hidden-input">
          <button id="import-btn" class="icon-button btn" title="Import" aria-label="Import"><img src="icons/toolbar/import.svg" alt=""></button>
          <button id="validate-btn" class="icon-button btn" title="Validate" aria-label="Validate"><img src="icons/toolbar/validate.svg" alt=""></button>
          <label class="grid-label"><input type="checkbox" id="grid-toggle" checked> Grid</label>
          <input type="number" id="grid-size" value="20" min="1" title="Grid size">
          <label class="scale-label">1 px = <input type="number" id="scale-value" value="1" step="0.01" min="0"> <input type="text" id="scale-unit" value="in" size="3" aria-label="Scale unit"></label>
          <label class="slack-label">Slack % <input type="number" id="slack-pct" value="0" step="0.1" min="0"></label>
        </div>
        <div class="workspace">
          <aside id="palette" class="palette">
            <div id="component-buttons">
              <input type="text" id="palette-search" placeholder="Search" aria-label="Filter components">
                <div class="palette-card card">
                  <h3>Panel</h3>
                  <details id="panel-section" class="palette-section">
                    <summary><img src="icons/panel.svg" alt="" class="summary-icon"> Panel</summary>
                    <div id="panel-buttons" class="section-buttons"></div>
                  </details>
                </div>
                <div class="palette-card card">
                  <h3>Equipment</h3>
                  <details id="equipment-section" class="palette-section">
                    <summary><img src="icons/equipment.svg" alt="" class="summary-icon"> Equipment</summary>
                    <div id="equipment-buttons" class="section-buttons"></div>
                  </details>
                </div>
                <div class="palette-card card">
                  <h3>Load</h3>
                  <details id="load-section" class="palette-section">
                    <summary><img src="icons/load.svg" alt="" class="summary-icon"> Load</summary>
                    <div id="load-buttons" class="section-buttons"></div>
                  </details>
                </div>
                <div class="palette-card card">
                  <h3>Templates</h3>
                  <details id="template-section" class="palette-section">
                    <summary><img src="icons/oneline.svg" alt="" class="summary-icon"> Templates</summary>
                    <div id="template-buttons" class="section-buttons"></div>
                    <button id="template-export-btn" type="button" class="btn">Export</button>
                    <input type="file" id="template-import-input" accept=".json" class="hidden-input">
                    <button id="template-import-btn" type="button" class="btn">Import</button>
                  </details>
                </div>
            </div>
          </aside>
          <div class="oneline-editor">
            <svg id="diagram" width="800" height="600">
            <defs>
              <pattern id="grid" width="20" height="20" patternUnits="userSpaceOnUse">
                <path d="M20 0 L0 0 0 20" fill="none" stroke="#ccc" stroke-width="0.5" />
              </pattern>
              <marker id="arrow" viewBox="0 0 10 10" refX="10" refY="5" markerWidth="6" markerHeight="6" orient="auto" markerUnits="strokeWidth">
                <path d="M0,0 L10,5 L0,10 Z" fill="context-stroke" />
              </marker>
              <symbol id="icon-MLO" viewBox="0 0 80 40">
                <rect x="1" y="1" width="78" height="38" rx="10" fill="#fff" stroke="#333" stroke-width="2"/>
                <text x="40" y="25" font-size="12" text-anchor="middle" fill="#333">MLO</text>
              </symbol>
              <symbol id="icon-MCC" viewBox="0 0 80 40">
                <rect x="1" y="1" width="78" height="38" rx="10" fill="#fff" stroke="#333" stroke-width="2"/>
                <text x="40" y="25" font-size="12" text-anchor="middle" fill="#333">MCC</text>
              </symbol>
              <symbol id="icon-Transformer" viewBox="0 0 80 40">
                <rect x="1" y="1" width="78" height="38" rx="2" fill="#fff" stroke="#333" stroke-width="2"/>
                <circle cx="30" cy="20" r="8" fill="none" stroke="#333" stroke-width="2"/>
                <circle cx="50" cy="20" r="8" fill="none" stroke="#333" stroke-width="2"/>
              </symbol>
              <symbol id="icon-Switchgear" viewBox="0 0 80 40">
                <rect x="1" y="1" width="78" height="38" rx="2" fill="#fff" stroke="#333" stroke-width="2"/>
                <rect x="20" y="10" width="40" height="20" fill="#e0e0e0" stroke="#333" stroke-width="2"/>
              </symbol>
              <symbol id="icon-Load" viewBox="0 0 80 40">
                <circle cx="40" cy="20" r="18" fill="#fff" stroke="#333" stroke-width="2"/>
                <polyline points="40 8 32 20 44 20 36 32" fill="none" stroke="#333" stroke-width="2"/>
              </symbol>
              <symbol id="icon-equipment" viewBox="0 0 80 40">
                <rect x="1" y="1" width="78" height="38" rx="2" fill="#fff" stroke="#333" stroke-width="2"/>
                <circle cx="26" cy="20" r="8" fill="#e0e0e0" stroke="#333" stroke-width="2"/>
                <rect x="46" y="12" width="20" height="16" fill="#fff" stroke="#333" stroke-width="2"/>
              </symbol>
            </defs>
            <rect id="grid-bg" width="100%" height="100%" fill="url(#grid)" />
          </svg>
          <div id="voltage-legend" class="voltage-legend"></div>
          <div id="prop-modal" class="prop-modal"></div>
          <div id="cable-modal" class="prop-modal"></div>
          <div id="validation-modal" class="prop-modal"></div>
          <div id="defaults-modal" class="prop-modal"></div>
            <ul id="context-menu" class="context-menu">
              <li data-action="edit" data-context="component">Edit Properties</li>
              <li data-action="delete" data-context="component">Delete</li>
              <li data-action="duplicate" data-context="component">Duplicate</li>
              <li data-action="rotate" data-context="component">Rotate</li>
              <li data-action="paste" data-context="canvas">Paste</li>
            </ul>
          </div>
        </div>
        </section>
    </main>
  </div>
  <aside id="studies-panel" class="studies-panel hidden" aria-label="Studies">
    <div class="studies-header">
      <h2>Studies</h2>
      <button id="studies-close-btn" class="studies-close-btn" aria-label="Close">&times;</button>
    </div>
    <div class="studies-controls">
      <button id="run-loadflow-btn" type="button">Load Flow</button>
      <button id="run-shortcircuit-btn" type="button">Short Circuit</button>
        <button id="run-arcflash-btn" type="button">Arc Flash</button>
        <button id="run-harmonics-btn" type="button">Harmonics</button>
        <button id="run-motorstart-btn" type="button">Motor Start</button>
        <button id="run-reliability-btn" type="button">Reliability</button>
        <label style="display:block;margin-top:0.5em"><input type="checkbox" id="toggle-overlays" checked> Show Result Overlays</label>
      </div>
      <pre id="study-results" class="study-results"></pre>
      <div id="loadflow-results" class="study-results"></div>
    </aside>
  <aside id="lint-panel" class="lint-panel hidden" aria-label="Validation issues">
    <div class="lint-header">
      <h2>Fix-it Hints</h2>
      <button id="lint-close-btn" class="lint-close-btn" aria-label="Close">&times;</button>
    </div>
    <ul id="lint-list"></ul>
  </aside>
  <div id="toast" class="toast" role="status" aria-live="polite"></div>
</body>
</html>
