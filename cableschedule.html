<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Interactive table for organizing cable data and exporting schedules.">
  <title>Cable Schedule</title>
  <link rel="icon" href="icons/favicon.svg" type="image/svg+xml">
  <link rel="stylesheet" href="style.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js" defer></script>
  <script src="tableUtils.js" defer></script>
</head>
<body>
  <nav class="top-nav">
    <a href="index.html">Home</a>
    <a href="cableschedule.html" class="active" aria-current="page">Cable Schedule</a>
    <a href="racewayschedule.html">Raceway Schedule</a>
    <a href="ductbankroute.html">Ductbank</a>
    <a href="cabletrayfill.html">Tray Fill</a>
    <a href="conduitfill.html">Conduit Fill</a>
    <a href="optimalRoute.html">Optimal Route</a>
    <button id="settings-btn" class="settings-btn" aria-label="Settings" aria-expanded="false">⚙</button>
  </nav>
  <div id="settings-menu" class="settings-menu">
    <label><input type="checkbox" id="dark-toggle"> Dark Mode</label>
    <button id="help-btn" aria-expanded="false">Site Help</button>
  </div>
  <div class="container">
    <main class="main-content">
      <header class="page-header">
        <h1>Cable Schedule</h1>
        <p>Centralized table for managing cable data.</p>
      </header>
      <section class="card">
        <div style="margin-bottom:10px;">
          <button id="save-schedule-btn">Save Schedule</button>
          <button id="load-schedule-btn">Load Schedule</button>
          <button id="clear-filters-btn">Clear Filters</button>
          <button id="export-xlsx-btn">Export XLSX</button>
          <input type="file" id="import-xlsx-input" accept=".xlsx" style="display:none;">
          <button id="import-xlsx-btn">Import XLSX</button>
          <button id="delete-all-btn">Delete All Rows</button>
        </div>
        <div style="overflow-x:auto;">
          <table id="cableScheduleTable" class="sticky-table">
            <thead></thead>
            <tbody></tbody>
          </table>
        </div>
        <div style="margin-top:10px;">
          <button id="add-row-btn" class="primary-btn add-row-btn">Add Cable</button>
        </div>
      </section>
    </main>
  </div>
  <div id="help-modal" class="modal" aria-hidden="true" role="dialog" aria-labelledby="help-title">
    <div class="modal-content">
      <button id="close-help-btn" class="close-btn" aria-label="Close Help">&times;</button>
      <h2 id="help-title">Cable Schedule Help</h2>
      <p>This table allows managing cable data. Use the import/export buttons to work with Excel files.</p>
    </div>
  </div>
<script>
window.addEventListener('DOMContentLoaded',()=>{
const darkToggle=document.getElementById('dark-toggle');
const settingsBtn=document.getElementById('settings-btn');
const settingsMenu=document.getElementById('settings-menu');
if(settingsBtn&&settingsMenu){
  settingsBtn.addEventListener('click',()=>{
    const expanded=settingsMenu.style.display==='flex';
    settingsMenu.style.display=expanded?'none':'flex';
    settingsBtn.setAttribute('aria-expanded',String(!expanded));
  });
  document.addEventListener('click',e=>{
    if(!settingsMenu.contains(e.target)&&e.target!==settingsBtn){
      settingsMenu.style.display='none';
      settingsBtn.setAttribute('aria-expanded','false');
    }
  });
}
if(darkToggle){
  const sess=JSON.parse(localStorage.getItem('ctrSession')||'{}');
  if(sess.darkMode){
    document.body.classList.add('dark-mode');
    darkToggle.checked=true;
  }
  darkToggle.addEventListener('change',()=>{
    if(darkToggle.checked){
      document.body.classList.add('dark-mode');
    }else{
      document.body.classList.remove('dark-mode');
    }
    sess.darkMode=darkToggle.checked;
    localStorage.setItem('ctrSession',JSON.stringify(sess));
  });
}
const helpBtn=document.getElementById('help-btn');
const helpModal=document.getElementById('help-modal');
const closeHelpBtn=document.getElementById('close-help-btn');
if(helpBtn&&helpModal&&closeHelpBtn){
  const openModal=()=>{
    helpModal.style.display='flex';
    helpModal.setAttribute('aria-hidden','false');
    helpBtn.setAttribute('aria-expanded','true');
    closeHelpBtn.focus();
  };
  const closeModal=()=>{
    helpModal.style.display='none';
    helpModal.setAttribute('aria-hidden','true');
    helpBtn.setAttribute('aria-expanded','false');
  };
  helpBtn.addEventListener('click',openModal);
  closeHelpBtn.addEventListener('click',closeModal);
  helpModal.addEventListener('click',e=>{ if(e.target===helpModal) closeModal(); });
}

const INSULATION_TEMP_LIMIT={THHN:90,XLPE:90,PVC:75,XHHW:90,'XHHW-2':90,'THWN-2':90,THW:75,THWN:75,TW:60,UF:60};
const conductorSizes=['#22 AWG','#20 AWG','#18 AWG','#16 AWG','#14 AWG','#12 AWG','#10 AWG','#8 AWG','#6 AWG','#4 AWG','#2 AWG','#1 AWG','1/0 AWG','2/0 AWG','3/0 AWG','4/0 AWG','250 kcmil','350 kcmil','500 kcmil','750 kcmil','1000 kcmil'];
const cableTypes=['Power','Control','Signal'];
const conductorMaterials=['Copper','Aluminum'];
const insulationRatings=['60','75','90'];
const shieldingOptions=['','Lead','Copper Tape'];

const columns=[
  {key:'tag',label:'Tag',type:'text',group:'Identification',tooltip:'Unique identifier for the cable'},
  {key:'service_description',label:'Service Description',type:'text',group:'Identification',tooltip:'Description of the cable\'s purpose'},
  {key:'from_tag',label:'From Tag',type:'text',group:'Routing / Termination',tooltip:'Starting equipment or location tag'},
  {key:'to_tag',label:'To Tag',type:'text',group:'Routing / Termination',tooltip:'Ending equipment or location tag'},
  {key:'start_x',label:'Start X',type:'number',group:'Routing / Termination',tooltip:'X-coordinate of cable start'},
  {key:'start_y',label:'Start Y',type:'number',group:'Routing / Termination',tooltip:'Y-coordinate of cable start'},
  {key:'start_z',label:'Start Z',type:'number',group:'Routing / Termination',tooltip:'Z-coordinate of cable start'},
  {key:'end_x',label:'End X',type:'number',group:'Routing / Termination',tooltip:'X-coordinate of cable end'},
  {key:'end_y',label:'End Y',type:'number',group:'Routing / Termination',tooltip:'Y-coordinate of cable end'},
  {key:'end_z',label:'End Z',type:'number',group:'Routing / Termination',tooltip:'Z-coordinate of cable end'},
  {key:'zone',label:'Cable Zone',type:'number',group:'Routing / Termination',tooltip:'Routing zone or area number'},
  {key:'conduit_id',label:'Conduit',type:'text',group:'Routing / Termination',tooltip:'Conduit identifier if routed through conduit'},
  {key:'circuit_group',label:'Circuit Group',type:'number',group:'Routing / Termination',tooltip:'Circuit grouping number'},
  {key:'allowed_cable_group',label:'Allowed Group',type:'text',group:'Routing / Termination',tooltip:'Permitted cable grouping identifier'},
  {key:'cable_type',label:'Cable Type',type:'select',options:cableTypes,group:'Cable Construction & Specs',tooltip:'Category such as Power, Control, or Signal'},
  {key:'conductors',label:'Conductors',type:'number',group:'Cable Construction & Specs',tooltip:'Number of conductors within the cable'},
  {key:'conductor_size',label:'Conductor Size',type:'select',options:conductorSizes,group:'Cable Construction & Specs',tooltip:'Size of each conductor'},
  {key:'conductor_material',label:'Conductor Material',type:'select',options:conductorMaterials,group:'Cable Construction & Specs',tooltip:'Material of the conductors'},
  {key:'insulation_type',label:'Insulation Type',type:'select',options:Object.keys(INSULATION_TEMP_LIMIT),group:'Cable Construction & Specs',tooltip:'Insulation material type'},
  {key:'insulation_rating',label:'Insul Rating (°C)',type:'select',options:insulationRatings,group:'Cable Construction & Specs',tooltip:'Maximum temperature rating of insulation'},
  {key:'insulation_thickness',label:'Insul Thick (in)',type:'number',group:'Cable Construction & Specs',tooltip:'Insulation thickness in inches'},
  {key:'shielding_jacket',label:'Shielding/Jacket',type:'select',options:shieldingOptions,group:'Cable Construction & Specs',tooltip:'Shielding or outer jacket type'},
  {key:'cable_rating',label:'Cable Rating (V)',type:'number',group:'Electrical Characteristics',tooltip:'Maximum voltage rating'},
  {key:'est_load',label:'Est Load (A)',type:'number',group:'Electrical Characteristics',tooltip:'Estimated operating current'},
  {key:'duty_cycle',label:'Duty Cycle (%)',type:'number',group:'Electrical Characteristics',tooltip:'Duty cycle percentage'},
  {key:'length',label:'Length (ft)',type:'number',group:'Electrical Characteristics',tooltip:'Length of cable run'},
  {key:'notes',label:'Notes',type:'text',group:'Notes',tooltip:'Additional comments or notes'}
];

const cableTable=TableUtils.createTable({
  tableId:'cableScheduleTable',
  storageKey:TableUtils.STORAGE_KEYS.cableSchedule,
  addRowBtnId:'add-row-btn',
  saveBtnId:'save-schedule-btn',
  loadBtnId:'load-schedule-btn',
  clearFiltersBtnId:'clear-filters-btn',
  exportBtnId:'export-xlsx-btn',
  importInputId:'import-xlsx-input',
  importBtnId:'import-xlsx-btn',
  deleteAllBtnId:'delete-all-btn',
  columns
});

function getCableSchedule(){
  cableTable.save();
  return cableTable.getData();
}
window.getCableSchedule=getCableSchedule;
});
</script>
</body>
</html>
