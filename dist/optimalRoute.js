!function(){"use strict";window.addEventListener("DOMContentLoaded",()=>{document.querySelectorAll(".workflow-grid .workflow-card").forEach(e=>{const t=e.dataset.storageKey,n=e.querySelector(".status");n&&(t&&localStorage.getItem(t)?(e.classList.add("complete"),n.textContent="âœ“",n.setAttribute("aria-label","Completed")):n.textContent="Incomplete")})});const e="a[href],button:not([disabled]),textarea:not([disabled]),input:not([disabled]),select:not([disabled]),[tabindex]:not([tabindex='-1'])";function t(t,n){if("Tab"!==t.key)return;const d=n.querySelectorAll(e);if(!d.length)return;const o=d[0],a=d[d.length-1];t.shiftKey&&document.activeElement===o?(t.preventDefault(),a.focus()):t.shiftKey||document.activeElement!==a||(t.preventDefault(),o.focus())}window.initSettings=function(){const n=document.getElementById("settings-btn"),d=document.getElementById("settings-menu");if(n&&d){d.setAttribute("role","dialog"),d.setAttribute("aria-modal","true"),d.setAttribute("aria-hidden","true");let o=!1;const a=e=>{"Escape"===e.key?s():t(e,d)},i=()=>{o=!0,d.style.display="flex",d.setAttribute("aria-hidden","false"),n.setAttribute("aria-expanded","true"),document.addEventListener("keydown",a);const t=d.querySelectorAll(e);t.length&&t[0].focus()},s=()=>{o&&(o=!1,d.style.display="none",d.setAttribute("aria-hidden","true"),n.setAttribute("aria-expanded","false"),document.removeEventListener("keydown",a),n.focus())};n.addEventListener("click",()=>{o?s():i()}),document.addEventListener("click",e=>{o&&!d.contains(e.target)&&e.target!==n&&s()})}},window.initDarkMode=function(){const e=document.getElementById("dark-toggle"),t=JSON.parse(localStorage.getItem("ctrSession")||"{}");if(void 0===t.darkMode){const e=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches;t.darkMode=e,localStorage.setItem("ctrSession",JSON.stringify(t))}document.body.classList.toggle("dark-mode",t.darkMode),e&&(e.checked=!!t.darkMode),e&&e.addEventListener("change",()=>{document.body.classList.toggle("dark-mode",e.checked),t.darkMode=e.checked,localStorage.setItem("ctrSession",JSON.stringify(t)),"function"==typeof window.saveSession&&window.saveSession(),"function"==typeof window.saveDuctbankSession&&window.saveDuctbankSession()}),window.addEventListener("storage",t=>{if("ctrSession"===t.key)try{const n=JSON.parse(t.newValue);document.body.classList.toggle("dark-mode",n&&n.darkMode),e&&(e.checked=!(!n||!n.darkMode))}catch{}})},window.initHelpModal=function(n="help-btn",d="help-modal",o){const a=document.getElementById(n),i=document.getElementById(d),s=o?document.getElementById(o):i?i.querySelector(".close-btn"):null;if(a&&i&&s){i.setAttribute("role","dialog"),i.setAttribute("aria-modal","true"),i.setAttribute("aria-hidden","true");const n=e=>{"Escape"===e.key?o():t(e,i)},d=()=>{i.style.display="flex",i.setAttribute("aria-hidden","false"),a.setAttribute("aria-expanded","true"),document.addEventListener("keydown",n);const t=i.querySelectorAll(e);t.length&&t[0].focus()},o=()=>{i.style.display="none",i.setAttribute("aria-hidden","true"),a.setAttribute("aria-expanded","false"),document.removeEventListener("keydown",n),a.focus()};a.addEventListener("click",d),s.addEventListener("click",o),i.addEventListener("click",e=>{e.target===i&&o()})}},window.initNavToggle=function(){const e=document.querySelector(".top-nav");if(!e)return;const t=e.querySelector(".nav-toggle");t&&t.addEventListener("click",()=>{e.classList.toggle("open")})},window.checkPrereqs=function(e=[]){const t=e.filter(e=>!localStorage.getItem(e.key));t.length&&document.addEventListener("DOMContentLoaded",()=>{const e=document.createElement("div");e.style.cssText="background:#fee;border:1px solid #f99;padding:10px;margin:10px;",e.innerHTML="Missing required data: "+t.map(e=>`<a href="${e.page}">${e.label}</a>`).join(", ")+".",document.body.prepend(e),document.querySelectorAll("main button, aside button").forEach(e=>e.disabled=!0)})},checkPrereqs([{key:"cableSchedule",page:"cableschedule.html",label:"Cable Schedule"},{key:"traySchedule",page:"racewayschedule.html",label:"Raceway Schedule"}])}();
