!function(){"use strict";window.addEventListener("DOMContentLoaded",()=>{document.querySelectorAll(".workflow-grid .workflow-card").forEach(e=>{const t=e.dataset.storageKey,s=e.querySelector(".status");if(!s)return;let n=!1;"racewaySchedule"===t?n=["ductbankSchedule","traySchedule","conduitSchedule"].some(e=>localStorage.getItem(e)):"optimalRoute"===t?n=["cableSchedule","traySchedule"].every(e=>localStorage.getItem(e)):t&&(n=!!localStorage.getItem(t)),n?(e.classList.add("complete"),s.textContent="âœ“",s.setAttribute("aria-label","Completed")):s.textContent="Incomplete"})});const e="a[href],button:not([disabled]),textarea:not([disabled]),input:not([disabled]),select:not([disabled]),[tabindex]:not([tabindex='-1'])",t="CTR_PROJECT_V1";function s(e={}){return{ductbanks:e.ductbanks||e.ductbankSchedule||[],conduits:e.conduits||e.conduitSchedule||[],trays:e.trays||e.traySchedule||[],cables:e.cables||e.cableSchedule||[],settings:e.settings||{session:e.session||e.ctrSession||{},collapsedGroups:e.collapsedGroups||{}}}}function n(t,s){if("Tab"!==t.key)return;const n=s.querySelectorAll(e);if(!n.length)return;const a=n[0],o=n[n.length-1];t.shiftKey&&document.activeElement===a?(t.preventDefault(),o.focus()):t.shiftKey||document.activeElement!==o||(t.preventDefault(),a.focus())}globalThis.migrateProject=s,function(){if("undefined"==typeof localStorage)return;const e=localStorage.getItem.bind(localStorage),n=localStorage.setItem.bind(localStorage),a=localStorage.removeItem.bind(localStorage);let o;try{o=JSON.parse(e(t))}catch{o=null}if(!o||"object"!=typeof o){const a={cables:JSON.parse(e("cableSchedule")||"[]"),trays:JSON.parse(e("traySchedule")||"[]"),conduits:JSON.parse(e("conduitSchedule")||"[]"),ductbanks:JSON.parse(e("ductbankSchedule")||"[]"),settings:{session:JSON.parse(e("ctrSession")||"{}"),collapsedGroups:JSON.parse(e("collapsedGroups")||"{}"),conduitFillData:JSON.parse(e("conduitFillData")||"null"),trayFillData:JSON.parse(e("trayFillData")||"null"),ductbankSession:JSON.parse(e("ductbankSession")||"{}")}};o=s(a),n(t,JSON.stringify(o))}function c(){n(t,JSON.stringify(o))}localStorage.getItem=function(s){if(s===t)return e(s);switch(s){case"cableSchedule":return JSON.stringify(o.cables||[]);case"traySchedule":return JSON.stringify(o.trays||[]);case"conduitSchedule":return JSON.stringify(o.conduits||[]);case"ductbankSchedule":return JSON.stringify(o.ductbanks||[]);case"collapsedGroups":return JSON.stringify(o.settings?.collapsedGroups||{});case"ctrSession":return JSON.stringify(o.settings?.session||{});default:return o.settings&&s in o.settings?JSON.stringify(o.settings[s]):null}},localStorage.setItem=function(e,s){if(e!==t){switch(e){case"cableSchedule":o.cables=JSON.parse(s);break;case"traySchedule":o.trays=JSON.parse(s);break;case"conduitSchedule":o.conduits=JSON.parse(s);break;case"ductbankSchedule":o.ductbanks=JSON.parse(s);break;case"collapsedGroups":o.settings.collapsedGroups=JSON.parse(s);break;case"ctrSession":o.settings.session=JSON.parse(s);break;default:o.settings||(o.settings={});try{o.settings[e]=JSON.parse(s)}catch{o.settings[e]=s}}c()}else n(e,s)},localStorage.removeItem=function(e){if(e!==t){switch(e){case"cableSchedule":o.cables=[];break;case"traySchedule":o.trays=[];break;case"conduitSchedule":o.conduits=[];break;case"ductbankSchedule":o.ductbanks=[];break;case"collapsedGroups":delete o.settings.collapsedGroups;break;case"ctrSession":delete o.settings.session;break;default:o.settings&&delete o.settings[e]}c()}else a(e)},globalThis.getProject=()=>JSON.parse(JSON.stringify(o)),globalThis.setProject=e=>{o=s(e),c()}}();const a="CTR_CONDUITS";globalThis.document?.addEventListener("DOMContentLoaded",function(){document.addEventListener("keydown",e=>{if("ArrowUp"!==e.key&&"ArrowDown"!==e.key)return;const t=e.target;if(!["INPUT","SELECT","TEXTAREA"].includes(t.tagName))return;const s=t.closest("td");if(!s||!s.closest("table"))return;const n=s.parentElement,a=s.cellIndex,o="ArrowUp"===e.key?n.previousElementSibling:n.nextElementSibling;if(!o)return;const c=o.cells[a];if(!c)return;const r=c.querySelector("input, select, textarea");r&&(e.preventDefault(),r.focus(),"function"==typeof r.select&&r.select())})}),globalThis.addEventListener?.("DOMContentLoaded",function(){const e=document.getElementById("export-project-btn"),t=document.getElementById("import-project-btn"),s=document.getElementById("import-project-input");e&&e.addEventListener("click",()=>{try{const e=globalThis.getProject?globalThis.getProject():{ductbanks:[],conduits:[],trays:[],cables:[],settings:{}},t=new Blob([JSON.stringify(e,null,2)],{type:"application/json"}),s=document.createElement("a");s.href=URL.createObjectURL(t),s.download="project.ctr.json",s.click(),setTimeout(()=>URL.revokeObjectURL(s.href),0)}catch(e){console.error("Export failed",e)}}),t&&s&&(t.addEventListener("click",()=>s.click()),s.addEventListener("change",e=>{const t=e.target.files[0];if(!t)return;const n=new FileReader;n.onload=e=>{try{const t=JSON.parse(e.target.result);globalThis.setProject&&globalThis.setProject(t),location.reload()}catch(e){console.error("Import failed",e)}},n.readAsText(t),s.value=""}))}),globalThis.initSettings=function(){const t=document.getElementById("settings-btn"),s=document.getElementById("settings-menu");if(t&&s){s.setAttribute("role","dialog"),s.setAttribute("aria-modal","true"),s.setAttribute("aria-hidden","true");let a=!1;const o=e=>{"Escape"===e.key?r():n(e,s)},c=()=>{a=!0,s.style.display="flex",s.setAttribute("aria-hidden","false"),t.setAttribute("aria-expanded","true"),document.addEventListener("keydown",o);const n=s.querySelectorAll(e);n.length&&n[0].focus()},r=()=>{a&&(a=!1,s.style.display="none",s.setAttribute("aria-hidden","true"),t.setAttribute("aria-expanded","false"),document.removeEventListener("keydown",o),t.focus())};t.addEventListener("click",()=>{a?r():c()}),document.addEventListener("click",e=>{a&&!s.contains(e.target)&&e.target!==t&&r()})}},globalThis.initDarkMode=function(){const e=document.getElementById("dark-toggle"),t=JSON.parse(localStorage.getItem("ctrSession")||"{}");if(void 0===t.darkMode){const e=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches;t.darkMode=e,localStorage.setItem("ctrSession",JSON.stringify(t))}document.body.classList.toggle("dark-mode",t.darkMode),e&&(e.checked=!!t.darkMode),e&&e.addEventListener("change",()=>{document.body.classList.toggle("dark-mode",e.checked),t.darkMode=e.checked,localStorage.setItem("ctrSession",JSON.stringify(t)),"function"==typeof window.saveSession&&window.saveSession(),"function"==typeof window.saveDuctbankSession&&window.saveDuctbankSession()}),window.addEventListener("storage",t=>{if("ctrSession"===t.key)try{const s=JSON.parse(t.newValue);document.body.classList.toggle("dark-mode",s&&s.darkMode),e&&(e.checked=!(!s||!s.darkMode))}catch{}})},globalThis.initHelpModal=function(t="help-btn",s="help-modal",a){const o=document.getElementById(t),c=document.getElementById(s),r=a?document.getElementById(a):c?c.querySelector(".close-btn"):null;if(o&&c&&r){c.setAttribute("role","dialog"),c.setAttribute("aria-modal","true"),c.setAttribute("aria-hidden","true");const t=e=>{"Escape"===e.key?a():n(e,c)},s=()=>{c.style.display="flex",c.setAttribute("aria-hidden","false"),o.setAttribute("aria-expanded","true"),document.addEventListener("keydown",t);const s=c.querySelectorAll(e);s.length&&s[0].focus()},a=()=>{c.style.display="none",c.setAttribute("aria-hidden","true"),o.setAttribute("aria-expanded","false"),document.removeEventListener("keydown",t),o.focus()};o.addEventListener("click",s),r.addEventListener("click",a),c.addEventListener("click",e=>{e.target===c&&a()})}},globalThis.initNavToggle=function(){const e=document.querySelector(".top-nav");if(!e)return;const t=e.querySelector(".nav-toggle");t&&t.addEventListener("click",()=>{e.classList.toggle("open")})},globalThis.checkPrereqs=function(e=[]){},globalThis.persistConduits=function(e){try{localStorage.setItem(a,JSON.stringify(e))}catch(e){console.error("Failed to persist conduits",e)}},globalThis.loadConduits=function(){try{const e=localStorage.getItem(a);if(e){const t=JSON.parse(e);return{ductbanks:t.ductbanks||[],conduits:t.conduits||[]}}}catch(e){}const e=globalThis.TableUtils?.STORAGE_KEYS?.ductbankSchedule||"ductbankSchedule",t=globalThis.TableUtils?.STORAGE_KEYS?.conduitSchedule||"conduitSchedule";let s=[],n=[];try{s=JSON.parse(localStorage.getItem(e)||"[]")}catch(e){}try{n=JSON.parse(localStorage.getItem(t)||"[]")}catch(e){}const o=[];return s=s.map(e=>{(e.conduits||[]).forEach(t=>{o.push({ductbankTag:e.tag,conduit_id:t.conduit_id,tray_id:`${e.tag}-${t.conduit_id}`,type:t.type,trade_size:t.trade_size,start_x:t.start_x,start_y:t.start_y,start_z:t.start_z,end_x:t.end_x,end_y:t.end_y,end_z:t.end_z,allowed_cable_group:t.allowed_cable_group})});const{conduits:t,...s}=e;return s}),{ductbanks:s,conduits:[...o,...n]}},checkPrereqs([{key:"cableSchedule",page:"cableschedule.html",label:"Cable Schedule"},{key:"traySchedule",page:"racewayschedule.html",label:"Raceway Schedule"}]),document.addEventListener("exclusions-found",()=>{const e=document.getElementById("route-breakdown-details");e&&(e.open=!0)})}();
