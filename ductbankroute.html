<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<meta name="description" content="Planner for ductbank routes with conduit layout and soil resistivity controls."/>
<title>Ductbank Route</title>
<link rel="icon" href="icons/favicon.svg" type="image/svg+xml">
<link rel="stylesheet" href="style.css">
<script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js" defer></script>
<script src="https://unpkg.com/gpu.js@2.10.4/dist/gpu-browser.min.js" defer></script>
<script src="soilResistivityConfig.js" defer></script>
<script src="conductorProperties.js" defer></script>
<script src="https://cdn.jsdelivr.net/npm/docx@8.5.0/build/index.umd.js" defer></script>
<script src="site.js" defer></script>
<script src="ductbankroute.js" defer></script>
</head>
<body class="ductbank-page">
<a href="#main-content" class="skip-link">Skip to main content</a>
<nav class="top-nav">
    <button class="nav-toggle" aria-label="Toggle navigation">☰</button>
    <div class="nav-links">
        <a href="index.html">Home</a>
        <a href="cableschedule.html">Cable Schedule</a>
        <a href="racewayschedule.html">Raceway Schedule</a>
        <a href="ductbankroute.html" class="active" aria-current="page">Ductbank</a>
        <a href="cabletrayfill.html">Tray Fill</a>
        <a href="conduitfill.html">Conduit Fill</a>
        <a href="optimalRoute.html">Optimal Route</a>
        <button id="settings-btn" class="settings-btn" aria-label="Settings" aria-expanded="false">⚙</button>
    </div>
</nav>
<div id="settings-menu" class="settings-menu">
 <label><input type="checkbox" id="dark-toggle"> Dark Mode</label>
 <button id="helpBtn" aria-expanded="false">Help</button>
 <button id="deleteDataBtn">Delete Saved Data</button>
</div>
<div class="container">
 <main id="main-content" class="main-content">
<header class="page-header">
 <h1>Ductbank Route</h1>
</header>
<details id="infoSection" open>
 <summary><strong>Ductbank Info</strong></summary>
 <div>
  <label>Ductbank Tag<input type="text" id="ductbankTag" style="margin-left:4px;"></label>
  <label style="margin-left:8px;">Concrete Encasement<input type="checkbox" id="concreteEncasement" style="margin-left:4px;"></label>
 <label style="margin-left:8px;">Ductbank Depth (in)<input type="number" id="ductbankDepth" min="0" step="1" style="width:60px;"></label>
 </div>
</details>

<details open>
 <summary><strong>Ductbank Conduits</strong></summary>
 <input type="file" id="importConduits" accept=".csv"/>
 <button type="button" id="addConduit">Add Conduit</button>
 <button type="button" id="sampleConduits">Load Sample Data</button>
 <input type="text" id="conduit-search" class="table-search" placeholder="Filter conduits">
 <table id="conduitTable" class="db-table">
  <thead>
   <tr>
    <th data-idx="0">ID</th>
    <th data-idx="1">Type</th>
    <th data-idx="2">Trade Size</th>
    <th data-idx="3">X</th>
    <th data-idx="4">Y</th>
    <th>Dup</th>
    <th>Del</th>
   </tr>
  </thead>
  <tbody></tbody>
 </table>
 </details>






<details open>
 <summary><strong>Cables</strong></summary>
 <input type="file" id="importCables" accept=".csv"/>
 <button type="button" id="addCable">Add Cable</button>
 <button type="button" id="sampleCables">Load Sample Data</button>
 <input type="text" id="cable-search" class="table-search" placeholder="Filter cables">
 <table id="cableTable" class="db-table">
  <thead>
   <tr>
    <th data-idx="0">Tag</th>
    <th data-idx="1">Type</th>
    <th data-idx="2">Diameter (in)</th>
    <th data-idx="3">Cond.</th>
    <th data-idx="4">Size</th>
    <th data-idx="5">Insul. Thick (in)</th>
    <th data-idx="6">Weight</th>
    <th data-idx="7">Est. Load (A)</th>
    <th data-idx="8">Conduit</th>
    <th data-idx="9">Conductor Material</th>
    <th data-idx="10">Insulation Type</th>
    <th data-idx="11">Insul. Rating (°C)</th>
    <th data-idx="12">Voltage Rating</th>
    <th data-idx="13">Shielding / Jacket Type</th>
    <th>Dup</th>
    <th>Del</th>
   </tr>
  </thead>
  <tbody></tbody>
 </table>
 <datalist id="sizeList">
  <option value="#22 AWG"></option>
  <option value="#20 AWG"></option>
  <option value="#18 AWG"></option>
  <option value="#16 AWG"></option>
  <option value="#14 AWG"></option>
  <option value="#12 AWG"></option>
  <option value="#10 AWG"></option>
  <option value="#8 AWG"></option>
  <option value="#6 AWG"></option>
  <option value="#4 AWG"></option>
  <option value="#2 AWG"></option>
  <option value="#1 AWG"></option>
  <option value="1/0 AWG"></option>
  <option value="2/0 AWG"></option>
  <option value="3/0 AWG"></option>
  <option value="4/0 AWG"></option>
  <option value="250 kcmil"></option>
  <option value="350 kcmil"></option>
  <option value="500 kcmil"></option>
  <option value="750 kcmil"></option>
  <option value="1000 kcmil"></option>
 </datalist>
</details>
<details id="paramSection" open style="margin-top:8px;">
 <summary><strong>Parameters</strong></summary>
 <div>
 <label>Ambient Earth Temperature (&#176;F)
  <span class="help-icon" tabindex="0" role="button" aria-label="Help" aria-expanded="false" aria-describedby="earthTempHelp">?
   <span id="earthTempHelp" class="tooltip">Degrees Fahrenheit of the surrounding soil. Typical 50–80°F.</span>
  </span>
  <input type="number" id="earthTemp" min="0" step="1" style="width:60px;">
 </label>
<label style="margin-left:8px;">Ambient Air Temperature (&#176;F)
  <span class="help-icon" tabindex="0" role="button" aria-label="Help" aria-expanded="false" aria-describedby="airTempHelp">?
   <span id="airTempHelp" class="tooltip">Air temperature around the installation in °F. Usually 50–110°F.</span>
  </span>
  <input type="number" id="airTemp" min="0" step="1" style="width:60px;">
 </label>
<label style="margin-left:8px;">Thermal Resistivity of Soil (&#176;C&#183;cm/W)
  <span class="help-icon" tabindex="0" role="button" aria-label="Help" aria-expanded="false" aria-describedby="soilResHelp">?
   <span id="soilResHelp" class="tooltip">Typical soil ranges from 40–150 &#176;C&#183;cm/W.</span>
  </span>
  <input type="number" id="soilResistivity" list="soilResList" min="0" step="1" style="width:120px;">
</label>
 <div id="soilWarning" style="display:none;font-size:0.8rem;color:var(--warning-text);"></div>
 <datalist id="soilResList"></datalist>
 <label style="margin-left:8px;">Moisture Content (%)
  <span class="help-icon" tabindex="0" role="button" aria-label="Help" aria-expanded="false" aria-describedby="moistureHelp">?
   <span id="moistureHelp" class="tooltip">Percent water by weight in soil.</span>
  </span>
  <input type="number" id="moistureContent" min="0" max="40" step="1" style="width:60px;">
 </label>
 <div id="moistureWarning" style="display:none;font-size:0.8rem;color:var(--warning-text);"></div>
<label style="margin-left:8px;">Allowable Conductor Temperature Tc
  <span class="help-icon" tabindex="0" role="button" aria-label="Help" aria-expanded="false" aria-describedby="ratingHelp">?
   <span id="ratingHelp" class="tooltip">Select the design insulation rating (°C).</span>
  </span>
  <select id="conductorRating" style="margin-left:4px;">
   <option value="60">60&#176;C</option>
   <option value="75">75&#176;C</option>
   <option value="90" selected>90&#176;C</option>
  </select>
 </label>
<label style="margin-left:8px;">Presence of Adjacent Heat Sources
  <span class="help-icon" tabindex="0" role="button" aria-label="Help" aria-expanded="false" aria-describedby="heatHelp">?
   <span id="heatHelp" class="tooltip">Toggle additional heat sources near the ductbank.</span>
  </span>
  <input type="checkbox" id="heatSources" style="margin-left:4px;">
 </label>
 <button type="button" id="addHeatSource" style="display:none;margin-left:4px;">Add Heat Source</button>
 <label style="margin-left:8px;">Grid Resolution
  <span class="help-icon" tabindex="0" role="button" aria-label="Help" aria-expanded="false" aria-describedby="gridHelp">?
   <span id="gridHelp" class="tooltip">Number of nodes used for the thermal solver.</span>
  </span>
  <select id="gridRes" style="margin-left:4px;">
   <option value="20" selected>20×20</option>
   <option value="40">40×40</option>
   <option value="80">80×80</option>
  </select>
 </label>
<label style="margin-left:8px;">Duct Thermal Resistance (&#176;C·m/W)
  <span class="help-icon" tabindex="0" role="button" aria-label="Help" aria-expanded="false" aria-describedby="ductResHelp">?
   <span id="ductResHelp" class="tooltip">Thermal resistance of the conduit itself. Leave 0 when using the preset table. Typical range 0–0.2 &#176;C·m/W.</span>
  </span>
  <input type="number" id="ductThermRes" value="0.0" placeholder="0.05" min="0" step="0.01" style="width:60px;">
</label>
</div>

<details id="soilRef" style="margin-top:8px;">
 <summary><strong>Typical Soil Properties</strong></summary>
 <table class="db-table" style="width:auto;">
  <thead>
   <tr><th>Soil Type</th><th>Thermal Resistivity (°C·cm/W)</th></tr>
  </thead>
  <tbody id="soilTableBody"></tbody>
 </table>
 <table class="db-table" style="margin-top:8px;width:auto;">
  <thead>
   <tr><th>Condition</th><th>Moisture Content (%)</th></tr>
  </thead>
  <tbody>
   <tr><td>Dry</td><td>2&#8211;5</td></tr>
   <tr><td>Damp</td><td>5&#8211;10</td></tr>
   <tr><td>Moist</td><td>10&#8211;20</td></tr>
   <tr><td>Wet / Saturated</td><td>20+</td></tr>
  </tbody>
 </table>
</details>

<details id="heatSourceDetails" open style="display:none;margin-top:8px;">
 <summary><strong>Adjacent Heat Sources</strong></summary>
 <table id="heatSourceTable" class="db-table">
 <thead>
  <tr>
   <th>Tag</th>
   <th>Shape</th>
   <th>Width (in)</th>
   <th>Height (in)</th>
   <th>Temp (°F)</th>
   <th>X</th>
   <th>Y</th>
    <th>Del</th>
   </tr>
  </thead>
  <tbody></tbody>
 </table>
</details>

<div style="margin-top:8px;">
  <label>Horiz Spacing (in)<input type="number" id="hSpacing" value="3" min="0" step="1" style="width:60px;"></label>
  <label>Vert Spacing (in)<input type="number" id="vSpacing" value="4" min="0" step="1" style="width:60px;"></label>
  <label>Top Clear (in)<input type="number" id="topPad" value="0" min="0" step="1" style="width:60px;"></label>
  <label>Bottom Clear (in)<input type="number" id="bottomPad" value="0" min="0" step="1" style="width:60px;"></label>
  <label>Left Clear (in)<input type="number" id="leftPad" value="0" min="0" step="1" style="width:60px;"></label>
 <label>Right Clear (in)<input type="number" id="rightPad" value="0" min="0" step="1" style="width:60px;"></label>
 <label>Conduits/Row<input type="number" id="perRow" value="4" min="1" step="1" style="width:60px;"></label>
</div>
</details>

<div id="warning-area" style="display:none;"></div>

<div id="gridContainer" style="position:relative;display:inline-block;">
    <svg id="grid" width="500" height="500" style="position:relative;z-index:1;"></svg>
    <canvas id="tempCanvas" width="500" height="500" style="position:absolute;top:0;left:0;pointer-events:none;z-index:2;display:none;opacity:0.7;"></canvas>
    <canvas id="tempOverlay" width="500" height="500" style="position:absolute;top:0;left:0;pointer-events:none;z-index:3;display:none;"></canvas>
  </div>
<label style="display:block;margin-top:4px;"><input type="checkbox" id="hideDrawing"> Hide Drawing</label>

<details id="ampacityDetails" open style="margin-top:8px;">
 <summary><strong>Ampacity Estimates</strong></summary>
 <div id="ampacityReport"></div>
</details>
<button id="scrollTopBtn" style="margin-top:4px;">Scroll to Top</button>

<div class="db-button-panel">
 <button id="calc">Calculate Fill</button>
 <button id="thermalBtn">Thermal Analysis</button>
 <button id="heatToggleBtn">Toggle Heat Map</button>
 <button id="exportBtn">Download Ductbank Data</button>
 <button id="exportConduitsBtn">Export Ductbank Conduits</button>
  <button id="exportCablesBtn">Export Ductbank Cables</button>
  <button id="exportImgBtn">Export Image</button>
  <button id="exportThermalBtn">Download Thermal Data</button>
  <button id="exportCanvasDataBtn">Download Canvas Data</button>
 <button id="downloadCalcReportBtn">Download Calculation Report</button>
  <button id="resetBtn">Reset Inputs</button>
 </div>

<div id="analysis-progress-container" style="display:none;">
  <div id="analysis-progress-bar" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0"></div>
  <span id="analysis-progress-label"></span>
</div>
<div id="solver-info" style="font-size:0.9rem;margin-top:4px;"></div>

 <nav class="step-nav">
  <a href="racewayschedule.html">Previous</a>
  <a href="cabletrayfill.html">Next</a>
 </nav>

 </main>
</div>

<div id="helpOverlay" aria-hidden="true" role="dialog">
 <div id="helpPopup">
  <button id="helpClose">Close</button>
  <h2>Ductbank Route Help</h2>
  <p>Use the <strong>Ductbank Conduits</strong> table to define each conduit by ID, type, trade size and its X/Y position.</p>
  <p>The <strong>Cables</strong> table lists every cable to be pulled. Diameter is the outside diameter in inches. Specify which conduit each cable is installed in.</p>
  <p>Click <em>Add Conduit</em> or <em>Add Cable</em> to create rows manually, or use <em>Import&nbsp;CSV</em> to load your own files. <em>Load Sample Data</em> fills the tables with example values.</p>
  <p>After entering data, press <strong>Calculate Fill</strong> to draw the ductbank. Conduits are colored by fill percentage and display individual cable circles. Hover over a conduit to see its fill and cable tags.</p>
  <p>The <strong>Download Ductbank Data</strong> button exports all conduits, cables and fill results to an XLSX file.</p>
  <p><strong>Export Ductbank Conduits</strong> and <strong>Export Ductbank Cables</strong> create CSV files compatible with the import buttons.</p>
  <h3>Reporting and Export</h3>
  <p>The <em>Download Calculation Report</em> button saves a formatted <code>.docx</code> summary. The report includes a legend describing each calculation variable and its units. <em>Export Ductbank Conduits</em> and <em>Export Ductbank Cables</em> produce CSV or JSON files, while <em>Export Image</em> saves an SVG of the cross‑section. These downloads include the current version and note the assumptions used so results remain traceable.</p>
  <h3>NEC Fill Rules</h3>
  <p>NEC Chapter&nbsp;9 Table&nbsp;1 limits conduit fill to 53% with one cable, 31% with two cables and 40% with three or more cables. Table&nbsp;4 provides areas for each conduit type and size.</p>
  <h3>Ampacity Calculation</h3>
  <p>Ampacity is estimated using the full Neher-McGrath equation:</p>
  <pre>I = sqrt( (T<sub>c</sub> - (T<sub>a</sub> + &Delta;T<sub>d</sub>)) /
             (R<sub>dc</sub> &times; (1 + Y<sub>c</sub>) &times; R<sub>ca</sub>) )</pre>
  <p>Here T<sub>c</sub> is the allowable conductor temperature in &deg;C. T<sub>a</sub> comes from the entered earth and air temperatures&mdash;those values are input in &deg;F and converted to &deg;C for the calculation. &Delta;T<sub>d</sub> is the dielectric-loss rise and Y<sub>c</sub> accounts for AC skin effect.</p>
  <p>The soil resistance uses <code>R<sub>soil</sub> = (&#x03c1;<sub>m</sub> / (2&pi;)) &middot; ln(4&nbsp;d / D)</code> with &#x03c1;<sub>m</sub> = &#x03c1;/100, burial depth <em>d</em> and conduit diameter <em>D</em> in meters. Duct resistance comes from a material and trade-size table and increases when concrete encased.</p>
  <p>See <a href="docs/AMPACITY_METHOD.md#ac-resistance-correction" target="_blank">AC Resistance Correction</a> for details on skin effect and dielectric loss. Typical soils appear in <a href="docs/AMPACITY_METHOD.md#soil-resistivity-ranges" target="_blank">Soil Resistivity Ranges</a>.</p>
  <h3>Thermal Analysis</h3>
  <p>The <em>Thermal Analysis</em> button overlays a heat map on the drawing. Each conduit center is marked with a yellow dot labeled with the estimated earth temperature in Fahrenheit and the hottest point is highlighted in red.</p>
  <p>Inputs are validated before running the analysis. Ductbank depth is limited to 0–120&nbsp;in, spacing between 1–24&nbsp;in and cable estimated load up to 2000&nbsp;A. Values outside these ranges will be clamped.</p>
  <p>Conduit fill limits come from NEC Chapter&nbsp;9, while ampacity calculations follow the Neher‑McGrath approach from NEC&nbsp;310‑15(C) and IEEE&nbsp;Std&nbsp;835. For a breakdown of the equation and variable meanings see <a href="docs/AMPACITY_METHOD.md#equation" target="_blank">Ampacity Method</a>. Soil resistivity guidance is summarized in <a href="docs/AMPACITY_METHOD.md#soil-resistivity-ranges" target="_blank">Soil Resistivity Ranges</a>. Additional references are listed in <a href="docs/standards.md" target="_blank">documentation</a>.</p>
</div>
</div>

<div id="toast" class="toast" role="status" aria-live="polite"></div>
  <p class="legalDisclaimer">
    Disclaimer: The calculations and diagrams generated by this tool are provided for reference only. Users are responsible for verifying the accuracy and applicability of all results. The creator of this website assumes no legal liability for their use.
  </p>
</body>
</html>
