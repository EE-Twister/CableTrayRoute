<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Tool for visualizing conduit fill capacity based on cable sizes." />
  <title>Conduit Fill Visualization</title>
  <link rel="icon" href="icons/favicon.svg" type="image/svg+xml">
  <link rel="stylesheet" href="style.css" />
  <script src="site.js" defer></script>
</head>
<body class="conduitfill-page">
  <nav class="top-nav">
    <a href="index.html">Home</a>
    <a href="cableschedule.html">Cable Schedule</a>
    <a href="racewayschedule.html">Raceway Schedule</a>
    <a href="ductbankroute.html">Ductbank</a>
    <a href="cabletrayfill.html">Tray Fill</a>
    <a href="conduitfill.html" class="active" aria-current="page">Conduit Fill</a>
    <a href="optimalRoute.html">Optimal Route</a>
    <button id="settings-btn" class="settings-btn" aria-label="Settings" aria-expanded="false">âš™</button>
  </nav>
  <div id="settings-menu" class="settings-menu">
    <label><input type="checkbox" id="dark-toggle"> Dark Mode</label>
    <button id="help-btn" aria-expanded="false">Help</button>
  </div>
  <div class="container">
    <main class="main-content">
      <header class="page-header">
        <h1>Conduit Fill Visualization</h1>
      </header>

      <fieldset>
        <legend><strong>Conduit Parameters</strong></legend>
        <label for="conduitType">Type:</label>
        <select id="conduitType"></select>

        <label for="tradeSize">Trade Size:</label>
        <select id="tradeSize"></select>
      </fieldset>

      <fieldset>
        <legend><strong>Enter Cables</strong></legend>
        <button id="addCableBtn" type="button">Add Cable</button>
        <table id="cableTable">
      <thead>
        <tr>
          <th>Tag</th>
          <th>Cable Type</th>
          <th>Conductors</th>
          <th>Conductor Size</th>
          <th>OD (in)</th>
          <th>Duplicate</th>
          <th>Remove</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
    <datalist id="sizeList">
      <option value="#22 AWG"></option>
      <option value="#20 AWG"></option>
      <option value="#18 AWG"></option>
      <option value="#16 AWG"></option>
      <option value="#14 AWG"></option>
      <option value="#12 AWG"></option>
      <option value="#10 AWG"></option>
      <option value="#8 AWG"></option>
      <option value="#6 AWG"></option>
      <option value="#4 AWG"></option>
      <option value="#2 AWG"></option>
      <option value="#1 AWG"></option>
      <option value="1/0 AWG"></option>
      <option value="2/0 AWG"></option>
      <option value="3/0 AWG"></option>
      <option value="4/0 AWG"></option>
      <option value="250 kcmil"></option>
      <option value="350 kcmil"></option>
      <option value="500 kcmil"></option>
      <option value="750 kcmil"></option>
      <option value="1000 kcmil"></option>
    </datalist>
  </fieldset>

      <div id="controls">
        <button id="drawBtn" type="button">Draw Conduit</button>
        <button id="expandBtn" type="button">Expand Image</button>
      </div>

      <div id="results"></div>
      <div id="svgContainer"></div>

      <!-- OVERLAY + POPUP FOR EXPANDED VIEW -->
      <div id="overlay">
        <div id="popup">
          <button id="popupClose" type="button">Close</button>
          <button id="copyPngBtn" type="button">Copy PNG</button>
          <button id="printBtn" type="button">Print SVG</button>
          <button id="copyBtn" type="button">Copy SVG</button>
          <div id="expandedSVG"></div>
        </div>
      </div>

    </main>
  </div>

  <div id="help-modal" class="modal" aria-hidden="true" role="dialog" aria-labelledby="help-title">
    <div class="modal-content">
      <button id="close-help-btn" class="close-btn" aria-label="Close Help">&times;</button>
      <h2 id="help-title">Conduit Fill Help</h2>
      <p>This tool visualizes conduit fill based on cable sizes.</p>
    </div>
  </div>

  <script>
    const CONDUIT_SPECS = {
      "EMT": {"1/2":0.304,"3/4":0.533,"1":0.864,"1-1/4":1.496,"1-1/2":2.036,"2":3.356,"2-1/2":5.858,"3":8.846,"3-1/2":11.545,"4":14.753},
      "ENT": {"1/2":0.285,"3/4":0.508,"1":0.832,"1-1/4":1.453,"1-1/2":1.986,"2":3.291},
      "FMC": {"3/8":0.116,"1/2":0.317,"3/4":0.533,"1":0.817,"1-1/4":1.277,"1-1/2":1.858,"2":3.269,"2-1/2":4.909,"3":7.069,"3-1/2":9.621,"4":12.566},
      "IMC": {"1/2":0.342,"3/4":0.586,"1":0.959,"1-1/4":1.647,"1-1/2":2.225,"2":3.63,"2-1/2":5.135,"3":7.922,"3-1/2":10.584,"4":13.631},
      "LFNC-A": {"3/8":0.192,"1/2":0.312,"3/4":0.535,"1":0.854,"1-1/4":1.502,"1-1/2":2.018,"2":3.343},
      "LFNC-B": {"3/8":0.192,"1/2":0.314,"3/4":0.541,"1":0.873,"1-1/4":1.528,"1-1/2":1.981,"2":3.246},
      "LFMC": {"3/8":0.192,"1/2":0.314,"3/4":0.541,"1":0.873,"1-1/4":1.277,"1-1/2":1.858,"2":3.269,"2-1/2":4.881,"3":7.475,"3-1/2":9.731,"4":12.692},
      "RMC": {"1/2":0.314,"3/4":0.549,"1":0.887,"1-1/4":1.526,"1-1/2":2.071,"2":3.408,"2-1/2":4.866,"3":7.499,"3-1/2":10.01,"4":12.882,"5":20.212,"6":29.158},
      "PVC Sch 80": {"1/2":0.217,"3/4":0.409,"1":0.688,"1-1/4":1.237,"1-1/2":1.711,"2":2.874,"2-1/2":4.119,"3":6.442,"3-1/2":8.688,"4":11.258,"5":17.855,"6":25.598},
      "PVC Sch 40": {"1/2":0.285,"3/4":0.508,"1":0.832,"1-1/4":1.453,"1-1/2":1.986,"2":3.291,"2-1/2":4.695,"3":7.268,"3-1/2":9.737,"4":12.554,"5":19.761,"6":28.567},
      "PVC Type A": {"1/2":0.385,"3/4":0.65,"1":1.084,"1-1/4":1.767,"1-1/2":2.324,"2":3.647,"2-1/2":5.453,"3":8.194,"3-1/2":10.694,"4":13.723},
      "PVC Type EB": {"2":3.874,"3":8.709,"3-1/2":11.365,"4":14.448,"5":22.195,"6":31.53}
    };

    document.addEventListener('DOMContentLoaded', () => {
      initSite();
      const stored = localStorage.getItem('conduitFillData');
      if (stored) {
        try {
          const { type, tradeSize, cables } = JSON.parse(stored);
          if (type) {
            typeSel.value = type;
            populateSizes();
          }
          if (tradeSize) {
            sizeSel.value = tradeSize;
          }
          if (Array.isArray(cables)) {
            tableBody.innerHTML = '';
            cables.forEach(c => {
              const row = createCableRow();
              row.children[0].querySelector('input').value = c.name || c.tag || '';
              row.children[1].querySelector('select').value = c.cable_type || '';
              row.children[2].querySelector('input').value = c.conductors || '';
              row.children[3].querySelector('input').value = c.conductor_size || '';
              row.children[4].querySelector('input').value = (c.diameter || c.od || c.OD || 0).toFixed(2);
              tableBody.appendChild(row);
            });
          }
          document.getElementById('drawBtn').click();
        } catch (e) {
          console.error('Failed to load conduitFillData', e);
        }
        localStorage.removeItem('conduitFillData');
      }
    });
  </script>
</body>
</html>
