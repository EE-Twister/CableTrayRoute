<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <meta name="description" content="Calculator for packing cables into trays and checking fill levels."/>
  <title>Cable Tray Packing</title>
  <link rel="icon" href="icons/favicon.svg" type="image/svg+xml">
  <link rel="stylesheet" href="style.css">

  <!-- SheetJS / xlsx for Excel import/export -->
  <script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js" defer></script>
  <script src="dirtyTracker.js" defer></script>
  <script src="dist/cabletrayfill.js" defer></script>
</head>
  <body class="cabletrayfill-page">
    <a href="#main-content" class="skip-link">Skip to main content</a>
    <nav class="top-nav">
      <button class="nav-toggle" aria-label="Toggle navigation">☰</button>
      <div class="nav-links">
        <a href="index.html">Home</a>
        <a href="cableschedule.html">Cable Schedule</a>
        <a href="racewayschedule.html">Raceway Schedule</a>
        <a href="ductbankroute.html">Ductbank</a>
        <a href="cabletrayfill.html" class="active" aria-current="page">Tray Fill</a>
        <a href="conduitfill.html">Conduit Fill</a>
        <a href="optimalRoute.html">Optimal Route</a>
        <button id="settings-btn" class="settings-btn" aria-label="Settings" aria-expanded="false">⚙</button>
      </div>
    </nav>
    <div id="settings-menu" class="settings-menu">
      <label><input type="checkbox" id="dark-toggle"> Dark Mode</label>
      <label for="unit-select">Units
        <select id="unit-select">
          <option value="imperial">Imperial</option>
          <option value="metric">Metric</option>
        </select>
      </label>
      <button id="help-btn" aria-expanded="false">Help</button>
      <button id="export-project-btn">Export Project</button>
      <button id="import-project-btn">Import Project</button>
      <input type="file" id="import-project-input" accept=".ctr.json" style="display:none;">
    </div>
    <div class="container">
      <main id="main-content" class="main-content">
        <header class="page-header">
          <h1>Cable Tray Packing</h1>
        </header>

        <!-- TRAY PARAMETERS -->
        <fieldset id="trayParameters">
    <legend><strong>Tray Parameters</strong></legend>
    <div class="tray-param-group">
      <div class="tray-param">
        <label for="trayWidth">Inside Width (in):</label>
        <select id="trayWidth">
          <option value="2">2</option>
          <option value="3">3</option>
          <option value="4">4</option>
          <option value="6">6</option>
          <option value="8">8</option>
          <option value="9">9</option>
          <option value="12" selected>12</option>
          <option value="16">16</option>
          <option value="18">18</option>
          <option value="20">20</option>
          <option value="24">24</option>
          <option value="30">30</option>
          <option value="36">36</option>
        </select>
      </div>
      <div class="tray-param">
        <label for="trayDepth">Load Depth (in):</label>
        <input type="number" id="trayDepth" min="2" step="1" value="3" />
      </div>
      <div class="tray-param">
        <label for="trayType">Tray Type:</label>
        <select id="trayType">
          <option value="ladder">Ladder (50 % fill)</option>
          <option value="solid">Solid Bottom (40 % fill)</option>
        </select>
      </div>
      <div class="tray-param">
        <!-- 1) New “Tray Name” input -->
        <label for="trayName">Tray Name:</label>
        <input type="text" id="trayName" placeholder="e.g. Main Power Run" />
      </div>
    </div>
  </fieldset>

  <!-- PROFILE CONTROLS -->
  <div id="profileControls">
    <h2>Profile Management <button class="helpBtn" data-help="Profiles are saved locally to your browser.">?</button></h2>
    <button id="saveProfileBtn" type="button">Save Profile</button>
    <label for="profileList">Load Profile:</label>
    <select id="profileList">
      <option value="">-- no profiles saved --</option>
    </select>
    <button id="loadProfileBtn" type="button">Load Profile</button>
    <button id="deleteProfileBtn" type="button">Delete Profile</button>
  </div>

  <!-- CABLE ENTRY TABLE -->
  <fieldset>
    <legend><strong>Enter Cables</strong></legend>
    <button id="addCableBtn" type="button">Add Cable</button>
    <button id="clearCableFiltersBtn" type="button">Clear Filters</button>
    <div id="cableTableWrapper">
    <table id="cableTable">
      <thead>
        <tr>
          <th>Tag <span class="required">*</span> <button class="helpBtn" data-help="Unique identifier or label for the cable.">?</button></th>
          <th>Cable Type <span class="required">*</span> <button class="helpBtn" data-help="Classify as Power, Control, or Signal.">?</button></th>
          <th>Conductors <span class="required">*</span> <button class="helpBtn" data-help="Number of conductors in the cable.">?</button></th>
          <th>Conductor Size <span class="required">*</span> <button class="helpBtn" data-help="Gauge or size of each conductor.">?</button></th>
          <th>Cable Rating (V) <button class="helpBtn" data-help="Voltage rating of the cable insulation.">?</button></th>
          <th>Operating Voltage (V) <button class="helpBtn" data-help="Actual working voltage on the cable.">?</button></th>
          <th>OD (in) <span class="required">*</span> <button class="helpBtn" data-help="Outer diameter of the cable in inches.">?</button></th>
          <th>Weight (lbs/ft) <span class="required">*</span> <button class="helpBtn" data-help="Cable weight per foot.">?</button></th>
          <th>Cable Zone <button class="helpBtn" data-help="Numeric zone for organizing cables. If Stackable and Non-Stackable Cables are placed in the same zone then a divider will automatically be added.">?</button></th>
          <th>Circuit Group <button class="helpBtn" data-help="Numeric group for bundling single conductor cables in groups of 3 or 4 conductors.">?</button></th>
          <th>Duplicate</th>
          <th>Remove</th>
        </tr>
      </thead>
      <tbody>
        <!-- rows inserted here by script -->
      </tbody>
    </table>
    </div>
    <p style="font-size:0.85rem; color:#555; margin-top:8px;">
      <strong>Conductors/Size:</strong> Enter the number of conductors and conductor size or pick one of the defaults.<br>
      OD & Weight auto-fill if you select a default.
    </p>
    <!-- DATASOURCE for default configurations -->
    <datalist id="sizeList">
      <!-- Populated by script -->
    </datalist>
  </fieldset>

  <!-- CONTROLS: Spacing Checkbox + Draw, Expand, Import/Export -->
  <div id="controls">
    <label>
      <input type="checkbox" id="largeSpacing" />
      Add one‐diameter spacing between Non-Stackable Cables
    </label>
    <br/>
    <button id="drawBtn" type="button">Draw Tray</button>
    <button id="expandBtn" type="button">Expand Image</button>
    <button id="importExcelBtn" type="button">Import Excel</button>
    <button id="exportExcelBtn" type="button">Export Excel</button>
    <button id="importHelpBtn" type="button">Import Help</button>
    <!-- Hidden file‐picker for .xlsx input -->
    <input type="file" id="importExcelInput" accept=".xlsx" style="display:none" />
  </div>

  <div id="results"></div>
  <div id="svgContainer"></div>

  <nav class="step-nav">
    <a href="ductbankroute.html">Previous</a>
    <a href="conduitfill.html">Next</a>
  </nav>

  <!-- OVERLAY + POPUP FOR EXPANDED VIEW -->
    <div id="overlay">
      <div id="popup">
        <button id="popupClose" type="button">Close</button>
        <button id="copyPngBtn" type="button">Copy PNG</button>
        <button id="printBtn" type="button">Print SVG</button>
        <button id="copyBtn" type="button">Copy SVG</button>
        <!-- Expanded SVG will be injected here -->
        <div id="expandedSVG"></div>
      </div>
    </div>

      </main>
    </div>

    <!-- HELP OVERLAY -->
    <div id="helpOverlay">
    <div id="helpPopup">
      <button id="helpClose" type="button">Close</button>
      <div id="helpContent">
        <h2>Help Documentation</h2>
        <p>This page calculates cable tray fill and displays a tray diagram.</p>
        <h3>Tray Parameters</h3>
        <p>Specify the tray width, load depth, tray type and an optional name.</p>
        <h3>Profile Management</h3>
        <p>Save or load groups of cables as profiles stored in your browser.</p>
        <h3>Entering Cables</h3>
        <p>Use <em>Add Cable</em> to create rows. Each column's <strong>?</strong> button explains the field.</p>
        <h3>Controls</h3>
        <ul>
          <li><strong>Add one-diameter spacing</strong> adds separation for non-stackable cables.</li>
          <li><strong>Draw Tray</strong> generates a small tray diagram.</li>
          <li><strong>Expand Image</strong> opens a larger graphic with copy and print options.</li>
          <li><strong>Import/Export Excel</strong> transfers the cable list to and from Excel.</li>
          <li><strong>Import Help</strong> shows tips for formatting Excel files.</li>
        </ul>
        <h3>Results</h3>
        <p>After drawing, tray size recommendations and fill details appear along with the graphic.</p>
        <p>Use the blue help buttons throughout the page for quick explanations of specific fields.</p>
      </div>
    </div>
  </div>

  <p id="legalDisclaimer" class="legalDisclaimer">
    Disclaimer: The calculations and diagrams generated by this tool are provided for reference only. Users are responsible for verifying the accuracy and applicability of all results. The creator of this website assumes no legal liability for their use.
  </p>
</body>
</html>
