<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Optimal 3D Cable Routing System</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
</head>
<body>
    <div class="container">
        <aside class="sidebar">
            <header>
                <h2>Input Parameters</h2>
            </header>
            
            <!-- Cable specification fields moved to the routing options card -->
            
            <section>
                <h3>Routing Parameters</h3>
                 <label for="fill-limit">Max Tray Fill (%)
                    <span class="help-icon" tabindex="0">?
                        <span class="tooltip">The maximum allowed fill capacity for a cable tray, based on standards like the NEC 40% rule.</span>
                    </span>
                 </label>
                 <input type="range" id="fill-limit" min="20" max="80" value="40" step="5">
                 <span id="fill-limit-value">40%</span>

                 <label for="proximity-threshold">Tray Proximity Threshold (in)
                    <span class="help-icon" tabindex="0">?
                        <span class="tooltip">The maximum distance a cable can jump from its start or end point to connect to a nearby tray segment.</span>
                    </span>
                 </label>
                 <input type="number" id="proximity-threshold" value="72" step="1">

                 <label for="field-route-penalty">Field Route Cost Multiplier
                    <span class="help-icon" tabindex="0">?
                        <span class="tooltip">This makes field routing (not in a tray) more expensive than routing within a tray. A value of 3 means every inch of field routing costs as much as 3 inches of tray routing, encouraging the algorithm to use trays whenever possible.</span>
                    </span>
                 </label>
                 <input type="number" id="field-route-penalty" value="3.0" step="0.1">

                 <label for="shared-field-penalty">Shared Field Route Cost Multiplier
                    <span class="help-icon" tabindex="0">?
                        <span class="tooltip">Multiplier applied when a cable uses an existing field-routed path from a previous cable. Use a value less than 1 to make shared field routes cheaper than new field routes.</span>
                    </span>
                 </label>
                 <input type="number" id="shared-field-penalty" value="0.5" step="0.1">
                 
                 <button id="calculate-route-btn" class="primary-btn">▶ Calculate Optimal Route</button>
                 <div id="progress-container" style="display:none;">
                     <div id="progress-bar"></div>
                     <span id="progress-label"></span>
                 </div>
                 <button id="cancel-routing-btn" style="display:none;">Cancel Routing</button>
            </section>
        </aside>

        <main class="main-content">
            <header>
                <h1>Optimal 3D Cable Routing System</h1>
                <p>Find the most efficient path for routing cables through tray networks with capacity constraints.</p>
            </header>

            <section class="card">
                <h2>Cable Tray Network</h2>
                <div class="tray-controls">
                    <div class="input-methods">
                        <input type="radio" id="manual-entry" name="input-method" value="manual" checked>
                        <label for="manual-entry">Manual Entry</label>
                        <input type="radio" id="sample-data" name="input-method" value="sample">
                        <label for="sample-data">Use Sample Data</label>
                    </div>
                    <div class="tray-import-export">
                        <button id="export-trays-btn">Export Trays CSV</button>
                        <input type="file" id="import-trays-file" accept=".csv" style="display:none;">
                        <button id="import-trays-btn">Import Trays CSV</button>
                        <button id="clear-trays-btn">Clear All Trays</button>
                    </div>
                </div>

                <div id="manual-entry-section">
                    <details>
                        <summary>Add New Tray Segment</summary>
                        <div class="tray-form">
                             <input type="text" id="t-id" placeholder="Tray ID">
                             <input type="number" id="t-sx" placeholder="Start X (ft)">
                             <input type="number" id="t-sy" placeholder="Start Y (ft)">
                             <input type="number" id="t-sz" placeholder="Start Z (ft)">
                             <input type="number" id="t-ex" placeholder="End X (ft)">
                             <input type="number" id="t-ey" placeholder="End Y (ft)">
                             <input type="number" id="t-ez" placeholder="End Z (ft)">
                             <input type="number" id="t-w" placeholder="Width (in)">
                             <input type="number" id="t-h" placeholder="Height (in)">
                             <input type="number" id="t-fill" placeholder="Current Fill (in²)">
                             <button id="add-tray-btn">Add Tray</button>
                        </div>
                    </details>
                    <details id="manual-tray-table-details">
                        <summary>Manual Cable Tray Entry Table</summary>
                        <div id="manual-tray-table-container"></div>
                    </details>
                </div>

                <details id="tray-utilization-details">
                    <summary>Tray Utilization</summary>
                    <div id="tray-utilization-container"></div>
                </details>
            </section>

            <section class="card">
                <h2>Cable Routing Options</h2>

                <div id="batch-section">
                    <button id="add-cable-btn">Add Cable to List</button>
                    <div class="cable-controls">
                        <button id="load-sample-cables-btn">Load Sample Cable List</button>
                        <div class="cable-import-export">
                            <button id="export-cables-btn">Export Cables CSV</button>
                            <input type="file" id="import-cables-file" accept=".csv" style="display:none;">
                            <button id="import-cables-btn">Import Cables CSV</button>
                        </div>
                        <button id="clear-cables-btn">Clear Cable List</button>
                    </div>
                    <details id="cable-list-details">
                        <summary>Cables to Route Table</summary>
                        <div id="cable-list-container"></div>
                    </details>
                </div>
            </section>
            
            <section id="results-section" class="card" style="display:none;">
                <h2>Routing Results</h2>
                <div id="messages"></div>
                <div id="metrics" class="columns"></div>
                <h3>Route Breakdown</h3>
                <div id="route-breakdown-container"></div>
                <h3>3D Route Visualization</h3>
                <div id="plot-3d"></div>
                <button id="popout-plot-btn">Open Full Screen</button>
                <h3>Updated Tray Utilization</h3>
                <div id="updated-utilization-container"></div>
                <button id="export-csv-btn">Download Route Data (CSV)</button>
            </section>
        </main>
    </div>
    <script src="app.js"></script>
</body>
</html>
